<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Получить файл</title>
<style>
body { background:#111; color:white; font-family:Arial; text-align:center; padding-top:100px; }
button { font-size:22px; margin-top:20px; display:none; }
</style>
</head>
<body>

<h2 id="status">Ожидание файла...</h2>
<button id="download">Скачать</button>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
socket.emit("role", "receiver");

let chunks = [];
let fileName = "";

socket.on("file-info", data => {
    fileName = data.name;
    document.getElementById("status").innerText = "Получаю: " + fileName;
    chunks = [];
});

socket.on("file-chunk", chunk => {
    chunks.push(chunk);
});

socket.on("file-end", () => {
    const blob = new Blob(chunks);
    const url = URL.createObjectURL(blob);
    const btn = document.getElementById("download");
    btn.style.display = "inline-block";
    btn.onclick = () => {
        const a = document.createElement("a");
        a.href = url;
        a.download = fileName;
        a.click();
    };
    document.getElementById("status").innerText = "Файл получен: " + fileName;
});
</script>

</body>
</html>
