<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Получить файл</title>
<style>
body {
    background:#111;
    color:white;
    font-family:Arial;
    text-align:center;
    padding-top:100px;
}
button {
    font-size:22px;
    margin-top:20px;
}
</style>
</head>
<body>

<h2 id="status">Ожидание файла...</h2>
<button id="download" style="display:none">Скачать</button>

<script>
const ws = new WebSocket(location.origin.replace("http", "ws"));
ws.binaryType = "arraybuffer";

let chunks = [];
let fileName = "";

ws.onopen = () => ws.send("receiver");

ws.onmessage = e => {
    if (typeof e.data === "string") {
        if (e.data === "EOF") {
            const blob = new Blob(chunks);
            const url = URL.createObjectURL(blob);

            const btn = document.getElementById("download");
            btn.style.display = "inline-block";
            btn.onclick = () => {
                const a = document.createElement("a");
                a.href = url;
                a.download = fileName;
                a.click();
            };

            document.getElementById("status").innerText = "Файл получен";
            chunks = [];
            return;
        }

        const info = JSON.parse(e.data);
        fileName = info.name;
        document.getElementById("status").innerText = "Получаю: " + fileName;
    } else {
        chunks.push(e.data);
    }
};
</script>

</body>
</html>
